<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>子任务一 车间环境监测与调节</title>
    <link rel="stylesheet" href="/static/css/bootstrap.min.css">
    <link rel="stylesheet" href="/static/css/index.css">
</head>
<body>
<div class="container">
    <div class="row">
        <div class="col-12">
            <div class="main-box">
                <div class="item">
                    <h3>车间安防系统</h3>
                </div>
                <div class="item"> 人感探测器：<span id="data_body"></span></div>
            </div>
        </div>
        <div class="col-12">
            <div class="main-box">
                <div class="item">
                    <h3>车间火灾预警系统</h3>
                </div>
                <div class="item"> 烟感探测器：<span id="data_smoke"></span></div>
                <div class="item"> 手动门锁控制：
                    <button onclick="closeLock()" class="btn btn-sm btn-success">闭合门锁</button>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="/static/js/jquery.min.js"></script>
<script src="/static/js/bootstrap.min.js"></script>
<script>
  function getData() {
    $.get("/sub02/getData", function (res) {
      data = JSON.parse(res)

      //TODO 将人感探测器与烟感探测器的状态分别展示到id为data_body和data_smoke的span中，有报警则显示有报警，无报警则显示正常
      document.getElementById("data_body").innerText = res[0] == 1 ? "有报警" : "正常"
      document.getElementById("data_smoke").innerText = res[1] == 1 ? "有报警" : "正常"
    })
  }

  function closeLock() {
    //TODO 使用Ajax，访问views.py中的set_data方法，关闭电磁门锁
    $.get('/sub02/setData')
  }
  window.onload = function () {
    getData()
    //TODO 编写计时器，每2秒执行getData获取最新数据
    window.setInterval(getData, 2000)
  }

</script>
</body>
</html>